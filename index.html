<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resep Ajaib Koki Cilik</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #f0e68c, #ffebcd);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #4a4a4a;
        }

        .game-container {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px 40px;
            text-align: center;
            width: 90%;
            max-width: 600px;
        }

        h1, h2 { color: #d2691e; }
        .level-info, .score-info { font-size: 1.2em; margin-bottom: 20px; }
        .question-box {
            background-color: #ffe4b5;
            border: 2px solid #d2691e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .answer-input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }
        
        input {
            border: 2px solid #d2691e;
            border-radius: 10px;
            padding: 10px;
            font-size: 1em;
            text-align: center;
        }

        #single-answer-input { width: 150px; }
        .answer-input-group input { width: 80px; }

        button {
            background-color: #d2691e;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s;
        }

        button:hover { transform: translateY(-3px); background-color: #e67e22; }
        .feedback { margin-top: 15px; font-weight: bold; min-height: 20px; }
        .feedback.correct { color: #28a745; }
        .feedback.incorrect { color: #dc3545; }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="intro-screen">
            <h1>üßë‚Äçüç≥ Resep Ajaib Koki Cilik üßë‚Äçüç≥</h1>
            <p>Halo, koki cilik! Mari belajar rasio untuk membuat resep yang lezat.</p>
            <div class="student-name-form">
                <p>Siapa nama kamu?</p>
                <input type="text" id="student-name-input" placeholder="Nama lengkap">
                <button onclick="startGame()">Mulai Petualangan!</button>
            </div>
        </div>
        
        <div id="game-screen" style="display: none;">
            <div class="level-info">
                <h2 id="lvl-title"></h2>
                <p id="lvl-desc"></p>
            </div>
            <div class="score-info">Skor: <span id="score">0</span> / 100</div>
            <div class="question-box">
                <p id="question-text"></p>
                <div id="input-area">
                    <div id="ratio-input-group" class="answer-input-group" style="display: none;">
                        <input type="number" id="answer-input-1" placeholder="Angka 1">
                        :
                        <input type="number" id="answer-input-2" placeholder="Angka 2">
                    </div>
                    <input type="number" id="single-answer-input" placeholder="Jawaban" style="display: none;">
                    <button id="submit-btn" onclick="checkAnswer()">Jawab!</button>
                </div>
                <div id="feedback-text" class="feedback"></div>
                <button id="next-btn" style="display: none;" onclick="nextQuestion()">Soal Selanjutnya</button>
            </div>
        </div>

        <div id="end-screen" style="display: none;">
            <h1>üéâ Permainan Selesai! üéâ</h1>
            <p>Selamat, <span id="student-name-final"></span>!</p>
            <p>Total skor kamu: <span id="final-score">0</span></p>
            <button onclick="resetGame()">Main Lagi!</button>
        </div>
    </div>

    <script>
        // --- KONFIGURASI ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx-VXraLQ1aMizP0LBclYsONBCGMDis8_yIGCc-ab8ah1ZMTsKA4zR1C94ljq_nOmon/exec';
        
        let studentName = "";
        let currentLevel = 0;
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let totalScore = 0;
        let levelQuestions = [];
        
        const questionsData = {
            level1: [
                { q: "Untuk jus stroberi, Koki menggunakan üçì 4 stroberi dan üçé 8 apel. Berapa rasio stroberi : apel?", a: "4:8" },
                { q: "Adonan pizza: üçö 3 tepung dan üíß 6 air. Berapa rasio tepung : air?", a: "3:6" },
                { q: "Dapur: ada ü•ï 5 wortel dan üçÖ 10 tomat. Berapa rasio wortel : tomat?", a: "5:10" },
                { q: "Kue: üç´ 2 cokelat dan ü•õ 4 susu. Berapa rasio cokelat : susu?", a: "2:4" }
            ],
            level2: [
                { q: "Tepung 10 : Air 5. Bentuk paling sederhana?", a: "2:1" },
                { q: "Apel 12 : Jeruk 6. Bentuk paling sederhana?", a: "2:1" },
                { q: "Cokelat 8 : Susu 16. Bentuk paling sederhana?", a: "1:2" }
            ],
            level3: [
                { q: "Rasio daging:tepung = 3:2. Jika daging 12kg, berapa tepung?", a: "8" },
                { q: "Rasio stroberi:apel = 1:2. Jika stroberi 5, berapa apel?", a: "10" }
            ],
            level4: [
                { q: "2 porsi jus butuh 10 stroberi. 5 porsi butuh berapa?", a: "25" },
                { q: "3kg tepung jadi 12 roti. 20 roti butuh berapa kg?", a: "5" }
            ],
            level5: [
                { q: "3 koki buat kue dlm 4 jam. 6 koki butuh berapa jam?", a: "2" },
                { q: "2 oven butuh 30 mnt. 4 oven butuh berapa mnt?", a: "15" }
            ]
        };

        const levelKeys = ["level1", "level2", "level3", "level4", "level5"];
        const levelDescriptions = {
            level1: "Pengenalan Rasio: Tuliskan perbandingan bahan!",
            level2: "Menyederhanakan Rasio: Perkecil angkanya!",
            level3: "Jumlah Sebenarnya: Hitung takaran pasti!",
            level4: "Perbandingan Senilai: Jika porsi bertambah!",
            level5: "Perbandingan Berbalik Nilai: Jika koki bertambah!"
        };

        function startGame() {
            studentName = document.getElementById('student-name-input').value.trim();
            if (studentName) {
                document.getElementById('intro-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                loadLevel();
            } else {
                alert("Masukkan nama kamu!");
            }
        }

        function loadLevel() {
            if (currentLevel >= levelKeys.length) {
                showEndScreen();
                return;
            }
            currentScore = 0;
            currentQuestionIndex = 0;
            document.getElementById('score').textContent = "0";
            
            const key = levelKeys[currentLevel];
            document.getElementById('lvl-title').textContent = `Level ${currentLevel + 1}`;
            document.getElementById('lvl-desc').textContent = levelDescriptions[key];
            
            // Ambil 4 soal acak
            levelQuestions = [...questionsData[key]].sort(() => 0.5 - Math.random()).slice(0, 4);
            showQuestion();
        }

        function showQuestion() {
            const q = levelQuestions[currentQuestionIndex];
            document.getElementById('question-text').textContent = q.q;
            document.getElementById('feedback-text').textContent = '';
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';

            if (currentLevel <= 1) {
                document.getElementById('ratio-input-group').style.display = 'flex';
                document.getElementById('single-answer-input').style.display = 'none';
                document.getElementById('answer-input-1').value = '';
                document.getElementById('answer-input-2').value = '';
                document.getElementById('answer-input-1').disabled = false;
                document.getElementById('answer-input-2').disabled = false;
            } else {
                document.getElementById('ratio-input-group').style.display = 'none';
                document.getElementById('single-answer-input').style.display = 'inline-block';
                document.getElementById('single-answer-input').value = '';
                document.getElementById('single-answer-input').disabled = false;
            }
        }

        function checkAnswer() {
            const q = levelQuestions[currentQuestionIndex];
            let userAnswer = "";
            let isCorrect = false;

            if (currentLevel <= 1) {
                const val1 = document.getElementById('answer-input-1').value.trim();
                const val2 = document.getElementById('answer-input-2').value.trim();
                userAnswer = `${val1}:${val2}`;
                
                // Cek fleksibilitas rasio (misal 4:8 sama dengan 1:2)
                const userRatio = parseFloat(val1) / parseFloat(val2);
                const correctParts = q.a.split(':');
                const correctRatio = parseFloat(correctParts[0]) / parseFloat(correctParts[1]);
                
                if (userRatio === correctRatio) isCorrect = true;
            } else {
                userAnswer = document.getElementById('single-answer-input').value.trim();
                if (userAnswer === q.a) isCorrect = true;
            }

            const feedback = document.getElementById('feedback-text');
            const status = isCorrect ? "Benar" : "Salah";
            
            if (isCorrect) {
                currentScore += 25;
                feedback.textContent = "Jawaban benar! üéâ";
                feedback.className = "feedback correct";
            } else {
                feedback.textContent = `Salah. Jawaban benar: ${q.a}`;
                feedback.className = "feedback incorrect";
            }

            document.getElementById('score').textContent = currentScore;
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            // KIRIM DATA KE SHEET
            sendDataToSheet(q.q, userAnswer, q.a, status);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < levelQuestions.length) {
                showQuestion();
            } else {
                totalScore += currentScore;
                currentLevel++;
                loadLevel();
            }
        }

        function sendDataToSheet(quest, userAns, correctAns, status) {
            const payload = {
                namaSiswa: studentName,
                level: currentLevel + 1,
                soal: quest,
                jawabanSiswa: userAns,
                jawabanBenar: correctAns,
                skor: status === "Benar" ? 25 : 0
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).catch(err => console.error("Gagal kirim data:", err));
        }

        function showEndScreen() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            document.getElementById('student-name-final').textContent = studentName;
            document.getElementById('final-score').textContent = totalScore;
        }

        function resetGame() {
            location.reload();
        }
    </script>
</body>
</html>
